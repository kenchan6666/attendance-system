<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>员工出席记录系统 - 前端测试</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    h1, h2 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background: #007bff; color: white; }
    input, button, select { padding: 8px; margin: 5px; font-size: 16px; }
    button { background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
    button:hover { background: #0056b3; }
    .section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .success { color: green; font-weight: bold; }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>员工出席记录系统</h1>

  <div class="section">
    <h2>员工列表</h2>
    <button onclick="loadEmployees()">刷新员工列表</button>
    <div id="employees"></div>
  </div>

  <div class="section">
    <h2>创建新员工</h2>
    <input type="text" id="code" placeholder="员工编号 (EMP001)" value="EMP001"><br>
    <input type="text" id="name" placeholder="姓名" value="陈逸楠"><br>
    <input type="email" id="email" placeholder="邮箱" value="test@example.com"><br>
    <input type="text" id="dept" placeholder="部门" value="IT"><br>
    <input type="text" id="position" placeholder="职位" value="Developer"><br>
    <input type="date" id="hire" value="2025-12-30"><br>
    <button onclick="createEmployee()">创建员工</button>
    <p id="createResult"></p>
  </div>

  <script>
    const API_URL = 'http://127.0.0.1:8000';

    async function loadEmployees() {
      try {
        const res = await fetch(`${API_URL}/employees/`);
        const data = await res.json();
        const div = document.getElementById('employees');
        if (data.length === 0) {
          div.innerHTML = '<p style="color:orange">还没有员工，请先创建！</p>';
          return;
        }
        let table = '<table><tr><th>ID</th><th>编号</th><th>姓名</th><th>部门</th><th>职位</th><th>入职日期</th></tr>';
        data.forEach(emp => {
          table += `<tr>
            <td>${emp.id}</td>
            <td>${emp.employee_code}</td>
            <td>${emp.full_name}</td>
            <td>${emp.department}</td>
            <td>${emp.position}</td>
            <td>${emp.hire_date}</td>
          </tr>`;
        });
        table += '</table>';
        div.innerHTML = table;
      } catch (err) {
        document.getElementById('employees').innerHTML = '<p class="error">连接失败，请确保后端正在运行！</p>';
      }
    }

    async function createEmployee() {
      const emp = {
        employee_code: document.getElementById('code').value,
        full_name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        department: document.getElementById('dept').value,
        position: document.getElementById('position').value,
        hire_date: document.getElementById('hire').value
      };

      try {
        const res = await fetch(`${API_URL}/employees/`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(emp)
        });
        if (res.ok) {
          const data = await res.json();
          document.getElementById('createResult').innerHTML = '<p class="success">创建成功！ID: ' + data.id + '</p>';
          loadEmployees(); // 自动刷新列表
        } else {
          const error = await res.json();
          document.getElementById('createResult').innerHTML = '<p class="error">错误: ' + JSON.stringify(error) + '</p>';
        }
      } catch (err) {
        document.getElementById('createResult').innerHTML = '<p class="error">连接失败！请确保后端运行中</p>';
      }
    }

    // 页面加载时自动获取员工列表
    loadEmployees();
  </script>
</body>
</html>